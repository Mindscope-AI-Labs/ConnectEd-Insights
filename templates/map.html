{% extends "base.html" %}

{% block content %}
<div id="map"></div>
<div class="legend">
    <div class="legend-item">
        <div class="legend-color" style="background: #4CAF50;"></div>
        <span>Adequate Connectivity (>20Mbps)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #FFC107;"></div>
        <span>Moderate Connectivity (10-20Mbps)</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background: #F44336;"></div>
        <span>Poor Connectivity (<10Mbps)</span>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    var map = L.map('map').setView([-1.2921, 36.8219], 7); // Centered on Kenya

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: ' OpenStreetMap contributors'
    }).addTo(map);

    function getColor(status) {
        if (status === 'adequate') return '#4CAF50';
        if (status === 'moderate') return '#FFC107';
        return '#F44336';
    }

    // Add school markers (this should be populated with actual data from your backend)
    fetch('/api/schools')
        .then(response => response.json())
        .then(schools => {
            schools.forEach(school => {
                L.circleMarker([school.latitude, school.longitude], {
                    radius: 8,
                    fillColor: getColor(school.connectivity_status),
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                })
                .bindPopup(`
                    <b>${school.name}</b><br>
                    Speed: ${school.speed} Mbps<br>
                    Status: ${school.connectivity_status}
                `)
                .addTo(map);
            });
        });
</script>
{% endblock %}
